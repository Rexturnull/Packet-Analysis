Lab 2 - XWorm.exe [ USB感染 ]
===
🔙 [Packet Analysis](../README.md)


```bash
https://bazaar.abuse.ch/sample/2ab95a9da810083604ea1051de47b179a0b27d132ab12e4a135e75495703e23e/
```

```bash
# 改名為svchost並執行

# 在工作管理員中看到svchost一直待在哪邊 並且描述是西班牙文

# 在資源監視器中找到(作弊)
port 2330

# 忽略TCP-80、TCP-443，先看其他通訊
# 外網 and 非常見通訊port and 三方交握 的封包
(not (ip.src == 10.0.0.0/8 and ip.dst==10.0.0.0/8)) and (not tcp.port in {80,443}) and tcp.flags.syn==1

# 可以觀察到D槽的USB所有資料已經被變成[捷近]
# 右鍵點進去看內容，發現他是導向同資料夾內的dwm.exe檔案

# 找到病毒藏匿的檔案
檔案總管 > ⋯ > 選項 > 檢視 
- 勾選 : 顯示隱藏的檔案、資料夾及磁碟機
- 取消 : 隱藏保護的作業系統檔案(建議選項)

# 刪除病毒
# 列出目前目錄下所有同時具有「系統」與「隱藏」屬性的檔案與資料夾。
dir /AS /AH
# 移除目前目錄下所有檔案的「唯讀(R)」、「系統(S)」、「隱藏(H)」屬性
attrib -R -S -H *.*
# 移除目前目錄及其所有子目錄中的檔案與資料夾的「唯讀(R)」、「系統(S)」、「隱藏(H)」屬性
attrib -R -S -H *.* /S /D

# 移除病毒產生的連結檔案
del *.lnk

# 會發現馬上有被病毒加密回去了，因為還有一部分躲在Tasks中
執行MMC > 開啟檔案 > C:/Windows/system32/taskschd.msc > 工作排程 > 觸發程序
就可以找到每分鐘執行的加密排程，一樣停用後刪除

# 分析 : 該病毒運行後，開啟2330 port傳輸資料，會將D槽USB檔案進行隱藏
# 重編為捷近，內容為去執行同資料夾中的dwm.exe惡意程式
# 在移除鏈結之後，檔案依然會被加密，因為病毒還做了工作排程
# 還需要另外再刪除並獨創早的排程
```

```bash
經驗上來說只要來自以下駟的地方的連線，基本上就是惡意的連線

東歐含俄羅斯 
中東含土耳其
非洲含印度洋
南美洲含加勒比海
```